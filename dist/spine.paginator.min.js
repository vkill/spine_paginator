// spine.paginator.js
// version: 0.1.0
// author: vkill
// license: MIT
(function(){var t,s,i,e;e=this.Spine||require("spine"),s=e.Model,i=function(){function t(t,s,i){var e;this._page=s,null==i&&(i={}),this._page=parseInt(this._page),(isNaN(this._page)||0>=this._page)&&(this._page=1),this._originalPage=this._page,this.perPage=i.perPage||this.constructor.DEFAULT_PER_PAGE,this.perPage=parseInt(this.perPage),(isNaN(this.perPage)||0>=this.perPage)&&(this.perPage=this.constructor.DEFAULT_PER_PAGE),this.maxPerPage=i.maxPerPage||this.constructor.MAX_PER_PAGE,this.window=i.window||i.inner_window||this.constructor.WINDOW,e=i.outer_window||this.constructor.OUTER_WINDOW,this.left=i.left||this.constructor.LEFT,0===this.left&&(this.left=e),this.right=i.right||this.constructor.RIGHT,0===this.right&&(this.right=e),this.originalRecords=this.cloneArray(t),this.totalCount=this.originalRecords.length,this.skipbuildButtonsAndLocals=i.skipbuildButtonsAndLocals,this.records=[],this.buttons=[],this.locals={},this.per()}return t.DEFAULT_PER_PAGE=25,t.MAX_PER_PAGE=null,t.WINDOW=4,t.OUTER_WINDOW=0,t.LEFT=0,t.RIGHT=0,t.prototype.per=function(t){var s,i,e;return i=parseInt(t),!isNaN(i)&&i>0&&(this.perPage=i,this._page=this._originalPage),s=this.offsetValue(),e=s+this.limitValue(),this.records=this.originalRecords.slice(s,e),null==this.skipbuildButtonsAndLocals&&this.buildButtonsAndLocals(),this},t.prototype.totalPages=function(){return Math.ceil(this.totalCount/this.limitValue())},t.prototype.currentPage=function(){return null==this.limitValue()?this.firstPage():this.offsetValue()/this.limitValue()+1},t.prototype.firstPage=function(){return 1},t.prototype.isFirstPage=function(){return this.currentPage()===this.firstPage()},t.prototype.lastPage=function(){return this.totalPages()},t.prototype.isLastPage=function(){return this.currentPage()>=this.lastPage()},t.prototype.pages=function(){var t,s,i,e,r,a,n,h;for(t=this.currentPage(),s=this.firstPage(),e=this.lastPage(),h=[],i=null,r=n=s;e>=s?e>=n:n>=e;r=e>=s?++n:--n)a=this.buildPage(r,i,t,s,e),i=a.isLeftOuter||a.isRightOuter||a.isInsideWindow?null:"gap",h.push(a);return h},t.prototype.curPage=function(){var t,s,i;return t=this.currentPage(),s=this.firstPage(),i=this.lastPage(),this.buildPage(t,null,t,s,i)},t.prototype.limitValue=function(){return this.perPage>this.totalCount&&(this.perPage=this.totalCount),null!=this.maxPerPage&&this.perPage>this.maxPerPage&&(this.perPage=this.maxPerPage),this.perPage},t.prototype.offsetValue=function(){var t;return t=this.totalPages(),this._page>t&&(this._page=t),(this._page-1)*this.limitValue()},t.prototype.buildPage=function(t,s,i,e,r){return{number:t,isCurrent:t===i,isFirst:t===e,isLast:t===r,isPrev:t===i-1,isNext:t===i+1,isLeftOuter:this.left>=t,isRightOuter:this.right>r-t,isInsideWindow:Math.abs(i-t)<=this.window,isWasTruncated:"gap"===s}},t.prototype.buildButtonsAndLocals=function(){var t,s,i,e,r,a,n;for(e=[],n={},t=this.curPage(),i=this.pages(),t.isFirst?n.hasFirst=!1:(e.push("first"),n.hasFirst=!0),t.isFirst?n.hasPrev=!1:(e.push("prev"),n.hasPrev=!0),n.pages=[],r=0,a=i.length;a>r;r++)s=i[r],s.isLeftOuter||s.isRightOuter||s.isInsideWindow?s.isCurrent?(e.push("current"),n.pages.push({number:s.number,current:!0})):(e.push(s.number),n.pages.push({number:s.number,current:!1})):s.isWasTruncated||(e.push("gap"),n.pages.push({number:s.number,gap:!0}));return t.isLast?n.hasNext=!1:(e.push("next"),n.hasNext=!0),t.isLast?n.hasLast=!1:(e.push("last"),n.hasLast=!0),n.first=this.firstPage(),n.current=this.currentPage(),n.last=this.lastPage(),n.numStart=0===this.records.length?0:this.offsetValue()+1,n.numEnd=this.offsetValue()+this.records.length,n.numTotal=this.totalCount,this.buttons=e,this.locals=n},t.prototype.cloneArray=function(t){var s,i,e,r;for(r=[],i=0,e=t.length;e>i;i++)s=t[i],r.push(s.clone());return r},t}(),t={_perPaginateRecords:function(){return this.records},page:function(t,s){return null==s&&(s={}),new i(this._perPaginateRecords(),t,s)}},s.Paginator={extended:function(){return this.extend(t)}},e.Paginator=i}).call(this);